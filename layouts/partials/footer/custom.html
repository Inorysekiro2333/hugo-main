<!-- 全局字体样式 -->
<style>
  @font-face {
    font-family: 'LXGWWenKai-Regular.ttf';
    src: url({{ (resources.Get "font/LXGWWenKai-Regular.ttf").Permalink }}) format('truetype');
  }

  :root {
    --base-font-family: 'LXGWWenKai-Regular.ttf';
    --code-font-family: 'LXGWWenKai-Regular.ttf';
  }
</style>

<!-- 目录自动展开样式 -->
<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<!-- 返回顶部按钮样式 -->
<style>
    #backTopBtn {
        display: none;
        position: fixed;
        right: 24px;
        bottom: 24px;
        z-index: 100;
        cursor: pointer;
        width: 44px;
        height: 44px;
        background: var(--card-background);
        border: 1px solid var(--line-color);
        border-radius: 12px;
        box-shadow: var(--shadow-l1);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #backTopBtn:hover {
        background: var(--accent-color);
        border-color: var(--accent-color);
        transform: translateY(-2px);
        box-shadow: var(--shadow-l2);
    }

    #backTopBtn svg {
        width: 20px;
        height: 20px;
        color: var(--card-text-color);
        transition: color 0.3s ease;
    }

    #backTopBtn:hover svg {
        color: #fff;
    }

    @media (max-width: 768px) {
        #backTopBtn {
            right: 16px;
            bottom: 16px;
            width: 40px;
            height: 40px;
        }
    }
</style>

<!-- 代码块展开按钮样式 -->
<style>
      .highlight {
        /* 你可以根据需要调整这个高度 */
        max-height: 400px;
        overflow: hidden;
    }

    .code-show {
        max-height: none !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#fff));
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer !important;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<!-- 代码块红绿灯头部 -->
<script>
    function initCodeHeader() {
        const codeBlocks = document.querySelectorAll('.highlight');
        codeBlocks.forEach(block => {
            // 检查是否已添加头部
            if (block.querySelector('.highlight-header')) {
                return;
            }
            // 创建红绿灯头部
            const header = document.createElement('div');
            header.className = 'highlight-header';
            // 红绿灯颜色：红、黄、绿
            const colors = ['#ff5f56', '#ffbd2e', '#27c93f'];
            colors.forEach(color => {
                const dot = document.createElement('span');
                dot.className = 'highlight-dot';
                dot.style.background = color;
                header.appendChild(dot);
            });
            // 将头部插入到代码块顶部
            block.insertBefore(header, block.firstChild);
        });
    }
    initCodeHeader();
</script>

<!-- 自动展开目录脚本 -->
<script>
    function initTocHide() {
        // 判断是否存在文章目录
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        // 监听滚动
        window.addEventListener('scroll', function() {
            //清除class值
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            // 获取active-class
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            // 展示子ul
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            // 展示父ul
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<!-- 返回顶部 -->
<script>
    function initScrollTop() {
        // 检查按钮是否已存在
        if (document.getElementById('backTopBtn')) {
            document.getElementById('backTopBtn').remove();
        }
        // 创建返回顶部按钮
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>`;
        btn.onclick = backToTop;
        // 添加到body
        document.body.appendChild(btn);

        // 滚动监听
        window.addEventListener('scroll', function() {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                btn.style.display = 'flex';
            } else {
                btn.style.display = 'none';
            }
        });
    }

    function backToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    initScrollTop();
</script>

<!-- 展开代码块 -->
<script>
    function initCodeMoreBox() {
    let codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) {
      return;
    }
    codeBlocks.forEach(codeBlock => {
      // 校验是否overflow
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
        return;
      }
      // 元素初始化
      // codeMoreBox
      let codeMoreBox = document.createElement('div');
      codeMoreBox.classList.add('code-more-box');
      // codeMoreBtn
      let codeMoreBtn = document.createElement('span');
      codeMoreBtn.classList.add('code-more-btn');
      codeMoreBtn.addEventListener('click', () => {
        codeBlock.classList.add('code-show');
        codeMoreBox.style.display = 'none';
        // 触发resize事件，重新计算目录位置
        window.dispatchEvent(new Event('resize'))
      })
      // img
      let img = document.createElement('img');
      img.classList.add('code-more-img');
      img.src = {{ (resources.Get "icons/codeMore.png").Permalink }}
      // 元素添加
      codeMoreBtn.appendChild(img);
      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox)
    })
  }
  
  initCodeMoreBox();
</script>


<!-- 樱花飞舞动态特效 -->
 <script src={{ (resources.Get "background/sakura.js").Permalink }}></script>


 <!-- pjax实现无缝加载 -->
  <!-- 【custom.html】 -->
<script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script>
<script>
    var pjax = new Pjax({
        selectors: [
            ".main-container"
        ]
    })
</script>

<script>
    pjax._handleResponse = pjax.handleResponse;
    pjax.handleResponse = function(responseText, request, href, options) {
        if (request.responseText.match("<html")) {
            if (responseText) {
                // 将新页面的html字符串解析成DOM对象
                let newDom = new DOMParser().parseFromString(responseText, 'text/html');
                // 获取新页面中body的className，并设置回当前页面
                let bodyClass = newDom.body.className;
                document.body.setAttribute("class", bodyClass)
            }
            // 放行，交给pjax自己处理
            pjax._handleResponse(responseText, request, href, options);
        } else {
            // handle non-HTML response here
        }
    }
</script>

<script>
    document.addEventListener('pjax:complete', () => {
        // Stack脚本初始化
        window.Stack.init();
        // 重新初始化代码块红绿灯
        initCodeHeader();
        // 重新初始化返回顶部按钮
        initScrollTop();
        // 重新初始化代码块展开
        initCodeMoreBox();
    })
</script>



<!-- 虚拟进度条 -->
<!--custom.html-->

{{ with resources.Get "js/topbar.min.js" }}
    <!-- 引入本地JS脚本 -->
    <script src={{ .Permalink }}></script>
{{ end }}
<script>
    // 修改进度条颜色
    topbar.config({
        barColors: {
            '0': 'rgba(255,  255, 255, 1)', // 进度0%白色
            '1.0': 'rgba(0, 149, 234,  1)' // 进度100%蓝色
        }
    })
	
    document.addEventListener('pjax:send', () => {
        // 显示顶部进度条
        topbar.show();
    })
	
    document.addEventListener('pjax:complete', () => {
        
        // 隐藏顶部进度条
        topbar.hide();
    })
</script>
